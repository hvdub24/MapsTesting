<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>

<!-- Mirrored from econym.org.uk/gmap/example_cartrip3.htm by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 24 Nov 2018 12:13:41 GMT -->
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Google Maps</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=AIzaSyAQLwtye7Rk-tjI7toc-zwOvMhTKd6hxtk" type="text/javascript"></script>
    <script src="epoly.js" type="text/javascript"></script>
    <script src="elabel.js" type="text/javascript"></script>
  </head>
  <!-- <body onunload="GUnload()"> -->
    
    <div id="controls">
     <form onsubmit="start();return false" action="#">
      <!-- Enter start and end addresses.<br /> -->
      <!-- <input type="text" size="80" maxlength="200" id="startpoint" value="Coldwater Canyon Drive, Beverly Hills, CA" /><br /> -->
      <!-- <input type="text" size="80" maxlength="200" id="endpoint" value="Laurel Pass Ave, Los Angeles, CA" /><br /> -->
	  <!-- <input type="text" size="80" maxlength="200" id="startpoint" value="17.445517, 78.397767" /><br /> -->
      <!-- <input type="text" size="80" maxlength="200" id="endpoint" value="17.515376, 78.347421" /><br /> -->
      <input type="submit" value="Start"  />
     </form>
    </div>

    <div id="map" style="width:100% ; height:500px"></div>
    <div id="step">&nbsp;</div>
    <div id="distance">Miles: 0.00</div>

    <canvas id="testcanvas" width="1" height="1"></canvas>

    <script type="text/javascript">
    //<![CDATA[
    if (GBrowserIsCompatible()) {
 
      var map = new GMap2(document.getElementById("map"));
      map.addControl(new GMapTypeControl());
      map.setCenter(new GLatLng(0,0),2);
      var dirn = new GDirections();
      var step = 5; // metres
      var tick = 100; // milliseconds
      var poly;
      var poly2;
      var eol;
      var car = new GIcon();
          car.image="lux_map_topview_large.png"
          car.iconSize=new GSize(32,18);
          car.iconAnchor=new GPoint(16,9);
      var marker;
      var k=0;
      var stepnum=0;
      var speed = "";
      var img = new Image();
          img.src = "lux_map_topview_large.png";
      var angle;
      var canvas;
      var lastVertex = 0;


      // ===== Check to see if this browser claims to support <canvas> ===
      if (document.getElementById('testcanvas').getContext) {
        var supportsCanvas = true;
      } else {
        var supportsCanvas = false;
      }   

     // Returns the bearing in radians between two points.
     function bearing( from, to ) {
       // See T. Vincenty, Survey Review, 23, No 176, p 88-93,1975.
       // Convert to radians.
       var lat1 = from.latRadians();
       var lon1 = from.lngRadians();
       var lat2 = to.latRadians();
       var lon2 = to.lngRadians();

       // Compute the angle.
       var angle = - Math.atan2( Math.sin( lon1 - lon2 ) * Math.cos( lat2 ), Math.cos( lat1 ) * Math.sin( lat2 ) - Math.sin( lat1 ) * Math.cos( lat2 ) * Math.cos( lon1 - lon2 ) );
       if ( angle < 0.0 )
	angle  += Math.PI * 2.0;

        
        			if (angle == 0) {crash;}


       return angle;
     }





      function plotcar() {
        var cosa = Math.cos(angle);
        var sina = Math.sin(angle);
        canvas.clearRect(0,0,66,66);
        canvas.save();
        canvas.rotate(angle);
        canvas.translate(33*sina+33*cosa,33*cosa-33*sina);
        canvas.drawImage(img,-33,-33);
        canvas.restore();
      }

function updatePoly(d) {
        // Spawn a new polyline every 20 vertices, because updating a 100-vertex poly is too slow
        if (poly2.getVertexCount() > 20) {
          poly2=new GPolyline([poly.getVertex(lastVertex-1)],'#0095ff', 6, 0.5);
          map.addOverlay(poly2)
        }

        if (poly.GetIndexAtDistance(d) < lastVertex+2) {
           if (poly2.getVertexCount()>1) {
             poly2.deleteVertex(poly2.getVertexCount()-1)
           }
           poly2.insertVertex(poly2.getVertexCount(),poly.GetPointAtDistance(d));
        } else {
          poly2.insertVertex(poly2.getVertexCount(),poly.getVertex(lastVertex++));
        }
      }
	  
      function animate(d) {
        if (d>eol) {
          document.getElementById("step").innerHTML = "<b>Trip completed<\/b>";
          document.getElementById("distance").innerHTML =  "Miles: "+(d/1609.344).toFixed(2);
          return;
        }
        var p = poly.GetPointAtDistance(d);
        if (k++>=180/step) {
          map.panTo(p);
          k=0;
        }
        marker.setPoint(p);
        document.getElementById("distance").innerHTML =  "Miles: "+(d/1609.344).toFixed(2)+speed;
        if (stepnum+1 < dirn.getRoute(0).getNumSteps()) {
          if (dirn.getRoute(0).getStep(stepnum).getPolylineIndex() < poly.GetIndexAtDistance(d)) {
            stepnum++;
            var steptext = dirn.getRoute(0).getStep(stepnum).getDescriptionHtml();
            document.getElementById("step").innerHTML = "<b>Next:<\/b> "+steptext;
            var stepdist = dirn.getRoute(0).getStep(stepnum-1).getDistance().meters;
            var steptime = dirn.getRoute(0).getStep(stepnum-1).getDuration().seconds;
            var stepspeed = ((stepdist/steptime) * 2.24).toFixed(0);
            step = stepspeed/2.5;
            speed = "<br />Current speed: " + stepspeed +" mph";
          }
        } else {
          if (dirn.getRoute(0).getStep(stepnum).getPolylineIndex() < poly.GetIndexAtDistance(d)) {
            document.getElementById("step").innerHTML = "<b>Next: Arrive at your destination<\/b>";
          }
        }
		//
		updatePoly(d);
		//
        if (supportsCanvas) {
          if (poly.GetIndexAtDistance(d)>lastVertex) {
            <!-- lastVertex = poly.GetIndexAtDistance(d); -->
            if (lastVertex == poly.getVertexCount()) {
              lastVertex -= 1;
            }
            while (poly.getVertex(lastVertex-1).equals(poly.getVertex(lastVertex))) {
              lastVertex-=1;
            }

            angle = bearing(poly.getVertex(lastVertex-1),poly.getVertex(lastVertex) );
            plotcar();
          }
        }
		
        setTimeout("animate("+(d+step)+")", tick);
      }

      GEvent.addListener(dirn,"load", function() {
        document.getElementById("controls").style.display="none";
        poly=dirn.getPolyline();
        eol=poly.Distance();
        map.setCenter(poly.getVertex(0),17);
        map.addOverlay(new GMarker(poly.getVertex(0),G_START_ICON));
        map.addOverlay(new GMarker(poly.getVertex(poly.getVertexCount()-1),G_END_ICON));
        if (supportsCanvas) {
          marker = new ELabel(poly.getVertex(0), '<canvas id="carcanvas" width="66" height="66"><\/canvas>',null,new GSize(-33,33));
	        map.addOverlay(marker);
          canvas = document.getElementById("carcanvas").getContext('2d');
          var p0 = poly.getVertex(0);
	        var p1 = poly.getVertex(1);
          angle = bearing(p0,p1);
          plotcar();
        } else {
          marker = new GMarker(poly.getVertex(0),{icon:car});
          map.addOverlay(marker);
        }
        var steptext = dirn.getRoute(0).getStep(stepnum).getDescriptionHtml();
        document.getElementById("step").innerHTML = steptext;
		//
		poly2 = new GPolyline([poly.getVertex(0)],'#0095ff', 6, 0.5);
        map.addOverlay(poly2);
		//
        setTimeout("animate(0)",2000);  // Allow time for the initial map display
      });

      GEvent.addListener(dirn,"error", function() {
        alert("Location(s) not recognised. Code: "+dirn.getStatus().code);
      });

      function start() {
		var cityLocations = [
    [17.445517, 78.397767],
    [17.458523, 78.367076],
    [17.515376, 78.347421]
];
	<!-- var gmarkers = []; -->
	<!-- for (var i = 0, len = cityLocations.length; i < len; i++) { -->
        <!-- gmarkers.push(new google.maps.LatLng(cityLocations[i][0], -->
                                             <!-- cityLocations[i][1])); -->
    <!-- } -->
	<!-- for (var i = 0; i < gmarkers.length-1; i++) { -->
    <!-- console.log(gmarkers[i]); -->
                <!-- dirn.loadFromWaypoints([gmarkers[i].toUrlValue(6),gmarkers[i+1].toUrlValue(6)],{getPolyline:true,getSteps:true}); -->

	<!-- } -->
		var point1 = "17.445517, 78.397767";
		var point2 = "17.458523, 78.367076";
		var point3 = "17.515376, 78.347421";
        dirn.loadFromWaypoints([point1, point2, point3],{getPolyline:true,getSteps:true});
		
		var points = [
   new GLatLng(17.445517, 78.397767),
   new GLatLng(17.458523, 78.367076),
   new GLatLng(17.515376, 78.347421)
];

<!-- var polyline = new GPolyline(points, '#f00', 1); -->

<!-- //map.setCenter(new GLatLng(47.676, -122.343), 12); -->
<!-- map.addOverlay(polyline); -->

		<!-- var pts = []; -->
		<!-- var points = []; -->
		<!-- points[0] = "17.445517, 78.397767"; -->
		<!-- points[1] = "17.458523, 78.367076"; -->
		<!-- points[2] = "17.515376, 78.347421"; -->
            <!-- for (var i = 0; i < points.length; i++) { -->
               <!-- pts[i] = new GLatLng(parseFloat(points[i].getAttribute("lat")), -->
                                   <!-- parseFloat(points[i].getAttribute("lng"))); -->
            <!-- } -->
            <!-- map.addOverlay(new GPolyline(pts,#ff0039,5, 0.5)); -->
      }
	  start();
	  // == when the load event completes, plot the point on the street ==
    <!-- GEvent.addListener(dirn,"load", function() { -->
<!-- // snap to last vertex in the polyline -->
        <!-- //var n = dirn.getPolyline().getVertexCount(); -->
            <!-- map.addOverlay(dirn.getPolyline()); -->
            <!-- //gpolys.push(dirn.getPolyline()); -->
            <!-- //dist += dirn.getPolyline().getDistance(); -->
            <!-- //document.getElementById("distance").innerHTML="Path length: "+(dist/1000).toFixed(2)+" km. "+(dist/1609.344).toFixed(2)+" miles."; -->
           <!-- }); -->
    <!-- GEvent.addListener(dirn,"error", function() { -->
        <!-- GLog.write("Failed: "+dirn.getStatus().code); -->
    <!-- }); -->
<!-- console.log(dirn); -->
// == when the load event completes, plot the point on the street ==
            GEvent.addListener(dirn, "load", function () {
                map.addOverlay(dirn.getPolyline());
            });
            GEvent.addListener(dirn, "error", function () {
                GLog.write("Failed: " + dirn.getStatus().code);
            });
            console.log(dirn);

    }

    // This Javascript is based on code provided by the
    // Community Church Javascript Team
    // http://www.bisphamchurch.org.uk/   
    // http://econym.org.uk/gmap/

    //]]>
    </script>
  <!-- </body> -->


<!-- Mirrored from econym.org.uk/gmap/example_cartrip3.htm by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 24 Nov 2018 12:13:42 GMT -->
</html>




